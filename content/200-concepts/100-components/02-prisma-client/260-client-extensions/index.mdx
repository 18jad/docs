---
title: 'Prisma Client extensions'
metaTitle: 'Prisma Client extensions (Preview)'
metaDescription: 'Extend the functionality of Prisma Client'
preview: true
tocDepth: 3
---

<TopBlock>

<Admonition type="warning">

This page is in draft.

</Admonition>

Use Prisma Client extensions to add functionality to the models in your schema, results objects, queries, or Prisma Client itself.

There are four types of extension. You can use each type to customize a different aspect of Prisma Client.

- `model` extensions: [add custom methods or fields to your models](/concepts/components/prisma-client/client-extensions/client-extensions-model)
- `client` extensions: [add client-level methods to Prisma Client](/concepts/components/prisma-client/client-extensions/client-extensions-client)
- `result` extensions (for future release): [add custom results objects to Prisma Client](/concepts/components/prisma-client/client-extensions/client-extensions-result)
- `query` extensions (for future release): [create custom Prisma Client queries](/concepts/components/prisma-client/client-extensions/client-extensions-query)

</TopBlock>

## About Prisma Client extensions

To create Prisma Client extensions, use the `$extends` [client-level method](/reference/api-reference/prisma-client-reference#client-methods), and the appropriate extension type (`model`, `client`, `query` or `result`).

You can use [multiple independent extensions at the same time](#multiple-extensions), each in is own isolated instance of Prisma Client.

You can also [share your Prisma Client extensions](#share-extensions) with other Prisma users, and [import Prisma Client extensions developed by other users](#install-a-packaged-extension) into your Prisma project.

## Prerequisites

To use Prisma Client extensions, you must enable the `clientExtensions` feature flag in the generator block of your `schema.prisma` file, as follows:

```prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}
```

## Multiple extensions

Each time that you call `$extends`, you create an _extended client_. This extended client is a forked state of the standard Prisma Client. The original client does not change.

Every extended client operates independently, in an isolated instance. It cannot conflict with other extended clients or the original client.

You can also combine two or more extensions into one extension, if you want the functionality from both extensions to apply in the same client instance.

### Examples of isolated client instances

Example uses of isolated client instances include the following:

- Implement row-level security (RLS), where each http request has its own client with its own RLS extension, customized with session data. This can keep each user entirely separate, each in a separate client.
- Add a `user.current()` method for the `user` model to get the current logged-in user
- Enable more verbose logging for requests if a debug cookie is set
- Attach a unique request id to all logs so you can correlate them later
- Remove a `delete` method from models unless the application calls the admin endpoint and the user has the necessary priviliges

### Declare multiple extensions

The following example declares two separate extensions and one combined extension:

```ts
// First of all, store your original prisma client in a variable as usual
const prisma = new PrismaClient()

// Declare extension A
const extendsA = prisma.$extends(extensionA)

// Declare extension B
const extendsB = prisma.$extends(extensionB)

// Declare an extension that is a combination of A and B
const extendsAB = prisma.$extends(extensionA).$extends(extensionB)
```

When you combine two or more extensions, then the last extension declared takes precedence in any conflict. In the example above, suppose there is a method called `getName` in `extendsA` and a method called `getName` in `extendsB`. When you call `extendsAB.getName`, then client uses `getName` as defined in `extendsB`.

### Extensions versus middlewares

Extensions differ from [middlewares](/concepts/components/prisma-client/middleware#performance-and-appropriate-use-cases) in the following ways:

- If you use two or more middlewares at the same time, then they all apply globally to the same client
- Extensions are isolated: the functionality in each one is separate, unless you deliberately combine them
- All extended clients share the same connection pool, but their functionality is separate
- In the RLS example given above, with extensions each user can be in an entirely separate client. With middlewares, all users are active in the same client.

## Share Prisma Client extensions

You can share Prisma Client extensions with other users, either as packages or as code snippets. To create an extension that is more likely to work for other users, use the `$all` prefix, for example [`$allModels`](/concepts/components/prisma-client/client-extensions/client-extensions-model#add-a-custom-method-to-all-models-in-your-schema). This extension applies generally, not just to your specific schema.

For example, a generic extension might take the following form:

```ts
const xprisma = new prisma.$extends({
  model: {
    $allModels: {
      getClass<T extends object>(this: T): new () => T {
        return class {
          /** Generic Implementation */
        } as any
      },
    },
  },
})

class UserService extends xprisma.user.getClass() {
  method() {
    const user = this.findFirst({}) // fully type-safe
  }
}
```

### Package an extension

To package an extension, use `Prisma.createExtension`. This is very similar to `prisma.$extends`, but it declares an extension.
For example:

```ts

import { Prisma } from '@prisma/client'

export default Prisma.createExtension({
  model: {
    $allModels: {
      // new method
      findOrCreate(...) { } // code for the new method goes inside the brackets
    }
  }
})
```

You could then share the above code on `npm` or as a code snippet.

### Install a packaged extension

In your project, you can install any Prisma Client extension that another user has published to `npm`. To do so, add the following line to your application code:

```ts
npm install prisma-extension-<name>
```

For example, if an available extension is called `find-or-create`, you could install it as follows:

```ts
npm install prisma-extension-find-or-create
```

To import the `find-or-create` extension from the example above, and load it into your client instance, you could use the following code:

```ts
import findOrCreate from 'prisma-extension-find-or-create'

const xprisma = prisma.$extends(findOrCreate)
const user = await xprisma.user.findOrCreate({ ... })

xprisma.user.findOrCreate()
```

<Admonition type = "info">

When you call a method in your extension, you must use the correct instance in your code. In the above example, `xprisma.user.findOrCreate` works, but `prisma.user.findOrCreate` does not.

</Admonition>
