---
title: 'Tracing'
metaTitle: 'Tracing (Preview)'
metaDescription: 'Diagnose application performance with detailed traces of each query.'
preview: true
tocDepth: 3
---

<TopBlock>

Prisma tracing logs
Prisma tracing outputs

Prisma tracing provides a detailed log of the activity that Prisma Client carries out, at a query level, including the time taken to execute each query. It helps you analyze your application's performance and identify bottlenecks. Tracing is fully compliant with [OpenTelemetry](https://opentelemetry.io/), so you can use it as part of your end-to-end application tracing path.

<Admonition type="info">

Tracing gives you a highly detailed, query-level insight into your Prisma project. If you want aggregated numerical reporting, such as query counts, connection counts, and total query execution times, see [Metrics](/concepts/components/prisma-client/metrics).

</Admonition>

</TopBlock>

## About tracing

When you enable tracing, Prisma Client writes out a trace for each request that it makes. **should we say operation here, rather than request**? Each trace includes one or more [spans](https://www.jaegertracing.io/docs/1.35/architecture/#span), each of which represents one stage in the request life-cycle (**check terminology here**), such as a database statement or command, or serialization and deserialization. Each span includes the round trip connection time from Prisma Client to the database and back.

**Diagram to show:**

- Trace (Prisma operation)

  - Span (connection)
  - Span (database statement or command)
  - Span (deserialization)

  You can send tracing output to the console, or analyze it in any OpenTelemetry-compatible tracing system, such as [Jaeger](https://www.jaegertracing.io/).

TBW:

- show screenshot in Jaeger with examples
- do we have child spans? what are the spans we offer?

Each span has different names dependant on the stage in the request, those with the name prisma:db_query will contain the generated SQL statement, and those other traces such as prisma and prisma:connection are other stages in the request such as: serialisation and deserialisation. In the screenshot I have expanded the trace showing all spans

Tracing output every SQL statement/command issues by Prisma Client.
yes - In the prisma:db_query spans you will see the db.statement tag where it will contain the SQL query(s) for that request.

## Output

Prisma tracing outputs the following information:

**TBW**
What's a unit of tracing?
What's in it?

Here is a breakdown of each stage/span in the trace:

- `prisma` - Trace to represent the whole Prisma request - from client to DB and back. This trace will contain information such as what model and method were called.
- `prisma:query_builder` - Trace to represent how long the Prisma engines take to generate the DB queries ie SQL. This includes deserialization of the Prisma client request, validation, and transformation into SQL.
- `prisma:connection` - Trace to represent how long it took to get a connection with the DB.
- `prisma:db_query` - Trace to represent each SQL query that was executed against the DB, what the SQL looks like(in the tags), and how long it took
- `prisma:itx_runner` which is the start of an interactive transactions
- `prisma:transaction` is the high level transaction

## Considerations and prerequisites

**TBD**

Do we want to say something about tracing's effect on performance? Something like "Note that tracing has a significant effect on performance in the following situations:" And maybe: "... we do not recommend that you use tracing in this situation in a production environment."

**Garren to provide some notes on performance considerations**

- Using the simple exporter will cause a large performance reduction (should only be used in development)
- Enabling sampling will make sure that not as many spans are set an make the performance very close to as if tracing was not exampled
- Tracing setup with a lot of prisma queries will be slower with tracing enabled

To use tracing, you must do the following:

1. [Install the appropriate dependencies](#step-1-install-up-to-date-prisma-dependencies).
1. [Enable the `tracing` feature flag in your Prisma schema file](#step-2-enable-the-feature-flag-in-the-prisma-schema-file).

### Step 1. Install up-to-date Prisma dependencies

Use version `4.1.0` or higher of the `prisma`, `@prisma/client`, and '@prisma/instrumentation' npm packages.

```terminal
npm install prisma@latest --save-dev
npm install @prisma/client@latest --save
npm install @prisma/instrumentation --save
npm install @opentelemetry/instrumentation --save
```

**TBA: do we need to install @opentelemetry/instrumentation?**

### Step 2: Enable the feature flag in the Prisma schema file

In the `generator` block of your `schema.prisma` file, enable the `tracing` feature flag:

```prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["tracing"]
}
```

### Step 3:

Add the following to your application code:

```ts
import { registerInstrumentations } from '@opentelemetry/instrumentation'
import { PrismaInstrumentation } from '@prisma/instrumentation'

export function otelSetup() {
  registerInstrumentations({
    instrumentations: [new PrismaInstrumentation()],
  })
}
```

## Send tracing to the console

To send tracing to the console, add the following to you application code:

Garren recommends we show how to configure otel to output to the console.

## Send tracing to Jaeger

To send tracing to Jaeger, add the following to you application code:

Get the application code sample to do this

How to generalize this to other tracing packages?
